package fdadf

import (
	"fmt"
	"math/rand"
	"reflect"
	"testing"

	"github.com/tetsuzawa/go-research/adflib/misc"
	"gonum.org/v1/gonum/floats"
)

func TestFiltFBLMS_Run(t *testing.T) {
	rand.Seed(1)
	//creation of data
	//number of samples
	n := 512
	L := 32
	m := n / L
	//input value
	var x = make([][]float64, m)
	//desired value
	var d = make([][]float64, m)
	var xRow = make([]float64, L)
	for i := 0; i < m; i++ {
		for j := 0; j < L; j++ {
			xRow = misc.Unset(xRow, 0)
			xRow = append(xRow, rand.NormFloat64())
		}
		x[i] = append([]float64{}, xRow...)
		copy(d[i], x[i])
	}
	type fields struct {
		n  int
		mu float64
		w  interface{}
	}
	type args struct {
		d [][]float64
		x [][]float64
	}
	tests := []struct {
		name    string
		fields  fields
		args    args
		want    [][]float64
		want1   [][]float64
		want2   [][]float64
		wantErr bool
	}{
		{
			name: "FBLMS Run",
			fields: fields{
				n:  L,
				mu: 0.020,
				w:  "zeros",
			},
			args: args{
				d: d,
				x: x,
			},
			want:    [][]float64{{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,}, {0.46007738165372203, -1.3803186425829086, -1.6881399569621849, -0.971590983452151, 0.7289706035243824, -0.4496201280365677, -1.5337818629990616, -0.2845843339914286, 0.564110159782512, 0.9835841699026178, -1.0032580655193672, 1.126796775471001, 0.7488500574253548, -1.2477713303539755, -0.2247454556492881, 0.9854744022310382, 1.1292955500063875, -0.26930473883800116, 0.4757588488555911, 0.671887178485945, 0.1827553601638851, -0.2993973507867862, -0.6913713304328268, 1.121677878714811, 0.6833316224750116, -0.25700026873473736, -0.7020631381852391, -0.16153079314623886, -0.8150706409232982, 0.08163686809212067, 0.9918041749704984, 0.0536721300062693,}, {-0.5499901530432605, 0.7448342327382161, -0.9387184087289965, -0.07603112862750572, 2.319040748678003, -0.2312316027934307, -0.6449562527217527, 1.0135716490197142, -0.5929506409074166, -0.5745089379609811, -0.3009382797449096, -1.5374329849948984, -1.8672021428493824, -0.34706416144471974, 1.4740706983752336, -0.3398872207448844, 0.31875266874322983, -0.2792869646180906, 0.7469266826223715, -0.4855484570323629, -1.2367940830224171, -0.48028316536253945, -0.6648084754197431, -1.9654757393061013, 0.5106293689271886, 0.4018504850341231, -1.1686851611705271, 0.12264560499496813, 0.5014610704206875, -0.6645284229821413, -0.025867780482950353, 0.6748901077899601,}, {2.4510645636773365, -0.046065414128246884, -0.861808271260569, -2.172248221607376, -0.7924943828125537, -0.8530825011536854, 0.22592462931712387, -1.5267059799160305, 1.8262697318582335, 1.9542599137878063, 0.5538735163615441, -0.6378408575472845, 0.5426983642192758, 0.6666565259744025, -1.0601106347403184, -2.7067628091435783, -0.22658579044524707, -0.6642859182455494, 2.8128593140422375, -2.1847014965642355, 0.20011033343908935, -0.35976155239930563, 0.8711053278754973, -1.1537813601260087, 0.6517318180688395, 0.8571761466924224, -1.0468010556265837, -1.0685742308647712, -0.9851160010276296, 0.46234593174875394, -2.2430676101644766, -0.3438743544775209,}, {-1.4096845203458517, 1.446371177860563, -1.1840341183693153, 0.6860062729458136, 0.9838079411324234, -0.44666564966574973, 0.4933127341655348, -1.2199906495484776, 1.7277340197076594, 0.03604729544114471, -1.5792048344243028, 0.31743392701530004, -1.513814332014998, -2.156617536513305, 1.1036183586173176, -0.41596394476843956, -0.8075285984521188, 0.049162320260414255, -0.902260169846409, 1.8799079565641355, 0.3344212206274579, 0.18347905312431062, -1.3173870731502568, -2.133617387285965, 0.2979616694545996, -2.4204512642025633, 0.9186126097620018, 0.48698161119663114, 0.26491222223711575, 1.0108283074467983, 0.9846005635810088, -0.10059755932982611,}, {-0.8484752062340359, -0.37041671352276767, -1.5226718882815493, -1.4665550041934856, -0.8331696878652992, -1.5366248587326234, -1.615474338607684, -1.638011245691183, -2.6938109881799255, -0.2787887412947641, -0.15877945172183106, 0.234065612400746, 1.482655760032729, -0.6184927849310131, 0.9912263798065973, 1.796844780477398, 0.8860873812694062, 0.5426587044623222, -1.0798130291847174, 1.352210499915377, -1.432760909732333, 0.4441852356474151, 0.8988133085784344, -1.3319249625756053, -1.2109816357212109, 0.38132601887875195, 0.07742531792055825, 0.7736685802420635, 1.175308339566438, -1.013951355980275, 0.36564423922283285, 0.2476594617621788,}, {-0.5298134533318059, 0.8911128433698643, -0.37397385476447476, 0.013943785759745086, 1.2710614398110296, 0.3275632618222116, -0.04710678581074346, 0.44701234826778946, -0.5138489251267417, 0.7475711689550613, 3.4027983120281124, 0.6929874228182734, 0.1005900331594044, -0.44057764681114564, 1.270917910503059, -0.23910221463435044, -0.13927880748254173, 0.6237327436495589, -0.021484205451519522, -1.30486165796995, 2.000002218633512, 0.6252377870354157, -0.6577070245428551, 0.43973235723081117, -0.548348677559299, -0.02961822283728685, -1.0059000139216225, -1.3918166819275726, -2.4636015076226965, 0.33004968505385646, -0.8957272650670562, -0.0839542632647518,}, {0.10897417094343356, -0.6413052105098935, -0.1969020184720565, 0.3832091292818139, -0.41736987578747287, 0.2490451053215524, -0.740028681703127, -1.1282562021083806, -0.3710503256221299, -0.7604691630220975, 0.387971535761896, 0.24963278582228587, -0.4748707250390405, 0.19965872848900795, -0.017517897500725854, -1.0453028906649646, -0.020698273539066586, -0.36883466157000006, 0.657993527938384, -1.0776074896480188, -0.12190478920676695, 1.713479936471884, 1.3367078571131115, 0.03398479139146976, -0.7523475214859705, 0.7552979073993027, -0.591057614973126, 1.399656408467234, -0.3576602727366337, 1.1206052443238792, -0.5404197874081357, -0.08867825456669728,}, {0.21778310783735516, -0.7090234553251921, 1.3082968906895114, 0.04074497222401796, 1.6651384993039233, -0.4303932003372316, -0.630607543443691, 0.10329775923580886, -0.6089350283641091, 1.2074512104423345, -0.016437087916263526, 0.18556910532409132, 0.9127691608149487, -0.3925480817494301, 0.4964849921346325, 0.0004987111092755736, -0.25213655320810885, 1.836255733483374, 0.20401614776220922, -1.4255675510180974, -0.37065034994704465, -0.4784683940359432, 1.300571009706367, 1.0582735991883352, 0.6570103450022742, -0.35660354680066125, 2.1790118321768004, -1.6442738094264668, -2.124234569677557, 0.5977349093901076, 0.4150695141267504, -0.06610582906719333,}, {0.17822545120234543, 0.7698002169659924, 0.5997285263080312, 1.285637792532046, 1.1556690285562023, 1.5739119342872039, -0.09726027990202143, -1.9688810653713809, 0.7448618122775705, -0.09747260853561601, 0.25770157112143277, -0.19773911159436083, 0.7898520674459838, -0.005083451182024551, -0.4214581692825508, 0.012537552973089769, -0.6151279038654209, 0.6921161293084901, -0.20251551187174954, -0.8212182758468438, -0.707207636435323, 0.494696101059573, 1.187388422616855, -0.11779112936710112, -0.20793316278585053, 1.8975660501162728, -0.013931300214642395, 0.4533242086974083, 0.6193347066812224, -0.08042727967740365, -0.6439023662794845, -1.6030425714453016,}, {-1.0896237288975472, -0.4106462286434671, 0.9325466901515111, -2.136079368102709, 1.7226372463386226, -0.8117974941470083, -0.3380599927042028, -1.667593462981228, -1.9424646146131987, 1.2572492066062169, 0.06811348660987782, 0.33706213869172824, -0.2188317694168217, 1.1990170956647521, 1.115427231372864, 0.7940503312719462, 0.3896024948435245, -0.37358380478451825, 0.029400429761084146, 0.8562057509421708, 0.6283210321904871, -0.4239023945031694, 0.8253252308581125, 0.019815390468183952, -0.01848050563892814, 0.14744955096694123, -1.2293489475459634, 0.7063428545409638, -0.46756637847532845, -1.0949546053800878, 0.7281452428721618, 1.225270660852686,}, {0.6265677500237772, -0.9172682958142897, -0.004455669246157645, -0.4160935992111151, 0.6272247550930622, 0.137561040855823, -0.06764107593958335, -0.3762918099258543, -0.10939644493351697, 0.16196645426494682, -0.5220450128749208, 0.13697867581197798, 0.9376629932247391, 0.9131645745672661, 0.84573215296851, 0.10039590688963562, -1.3718798532930494, 0.9482875741491135, -0.31085064302606447, -0.079882947663582, -0.18351028348664578, 0.5684031449385343, -1.509179750644894, -0.9496115325668645, 0.99295837301895, 1.3562250224087156, 1.386985460657734, -0.04073637833910032, 1.8127456295244353, 1.422127049899909, 0.10288632657298313, -0.7275495303487438,}, {-0.37655239769658183, -0.9029149192577381, 1.2093851161758409, -0.9948082028806122, 0.8248986227926337, -0.2832247880234969, 0.3562371904716743, -1.8660970721707253, -0.5977445140169972, 0.757682187565168, 1.7186384364700824, -0.5815422108397224, 0.38936003855072215, -0.6910646607287416, -1.2051282228328226, 0.29836650245373597, 0.7325912322326334, 0.3252436903899042, -0.16005221767186137, -2.1481830532077018, 0.6702324206432655, -0.18174198814985854, -1.530748326608674, 1.110992951400131, -0.6270360210209155, -0.43819926943595044, -0.5655062578018817, 1.4094482275371958, -0.3219914729672494, -0.3136299439059973, 0.9153221864788319, 0.9993411799698229,}, {-0.5187796132627355, 1.5017317939111354, -0.7204960663426518, -0.7216830889571331, -1.3555106876417071, -1.4994096385038187, 1.1427947013894393, 1.6448971760383158, -1.427280460517803, 0.30900908219166084, 0.7878995144473504, -1.8303333257176881, 0.6304550661960654, -0.012552798304598434, -0.731871615082125, -1.0414165613951727, 1.25986017005819, -2.344055448172583, 0.19511555933807942, -1.3515673216478565, -1.0584388932754005, 1.4910742684470841, -0.6842276516946303, 0.1707323587672358, -0.693167961737225, -1.010654033132411, 0.2786987855889965, -1.9330419069579325, -0.07597885320009141, 1.380913556177671, -0.8683529964894854, -1.222872422446753,}, {-0.38591242568340806, -1.0243470214591222, 0.3015681936488799, 0.2308868592967442, 1.2238999038707021, 2.607904295998254, -0.7891924971508909, -0.9795271472806183, 1.165941060113219, -0.8224131092403097, 0.1335933075363197, 0.3418388540401269, -0.45805110450325465, 0.30799047411256997, 0.3438517653980138, 0.14906757361682194, -1.1312362388481707, 0.9310767511876658, 0.7936026129683742, 0.672312789526448, -0.23411903459463362, -1.0855830062081213, 0.9843700350342368, -0.11346374477066162, -0.9104988478478246, 0.6096156655796634, 0.0044542464576645124, 0.6785567660066041, -1.098962560403825, -1.221192093612835, -0.6079205582152125, 0.6480906601006078,}, {-0.9643531281233302, 2.5540214432147197, 0.8283564324524346, 0.8235108428190829, 0.7329760469883193, 0.035043592254051514, 0.31463567607288395, 0.022272255596710866, -0.3104296567823369, 1.3388747055092693, 0.8642517108573364, -0.8410372508852579, 0.9459042734808418, 1.1740955393189396, 0.25471951249501706, -0.6528116382378615, -1.3758596971073975, 0.2918740663783996, -0.3674282861272157, 0.8328211099212177, -0.8689399030228973, 0.5319037428557036, 1.069294341009088, -0.005949238210218963, -0.18885665261474427, 0.1487203706911287, 1.0146920043723653, 0.8939988169143684, 2.0458912945585945, 0.48330312673399134, 1.4114917655595554, -0.5902442218031965,},},
			want1:   [][]float64{{-1.233758177597947, -0.12634751070237293, -0.5209945711531503, 2.28571911769958, 0.3228052526115799, 0.5900672875996937, 0.15880774017643562, 0.9892020842955818, -0.731283016177479, 0.6863807850359727, 1.585403962280623, 0.8382059044208106, 1.2988408475174342, 0.5273583930598617, 0.7324419258045132, -1.0731798210887524, 0.7001209024399848, 0.4315307186960532, 0.9996261210112625, -1.5239676725278932, -0.31653724289408824, 1.8894642062634817, 1.1007291937500208, -0.9927431907514367, 0.9897104202085316, -0.6152234852777649, -1.4350469221322282, -2.1514366827426445, 0.13735037357335078, 0.4428226270265666, -0.8460943734555971, -0.08279503413614919,}, {-0.3039508863709074, -0.07030460958756257, 1.9678836756253564, -0.7673154143563414, -0.026220341962201132, 0.7957590241914634, 0.4642364606460412, -0.5486675751983116, -0.23382077416985025, 0.7621575618753296, -0.11745602683726597, -0.3699979336243048, 0.1784484133387284, -0.2077344809983599, 1.1977798374924733, -1.2806880560564804, -0.6191794395203714, -0.20283206965786676, -0.2242188047964419, -0.7538246500195142, -0.01606464124558754, 0.6634424693173417, -0.9472697474236076, -0.2860095216888974, 0.47089919123502566, 0.18196392111994414, -0.06849780966455465, -0.9617623171129166, 0.0388574310495311, 0.5903069015845273, 0.42847532181838166, -0.42245059075363184,}, {0.2195333905682909, -0.8088683239643184, 0.6916836918987604, 0.24528208045859257, -0.5834074920234413, -0.03697003682148142, 0.4391223254648928, 0.1903867414133058, -0.45871465669652745, 0.07816154084837268, -0.37658526651822966, -0.3596096745020687, -0.09443576823552613, -0.3883803184248539, 0.5118485836058986, 0.4347063380998524, -0.3598907768122223, 0.10131468695361673, 0.4568049318640457, -0.5213405744285866, 0.398201320503067, 0.5817041452120392, -0.7382842529539221, -0.3609541158954337, 0.463653794961433, -0.1552443019648367, -0.8242772088209553, 0.49819576719349823, -0.12022733012073705, -0.3155762689978545, 0.43543897504240003, -0.1038079308434241,}, {0.07917387967507006, 0.417087483446565, -0.40843444723492417, -0.006562916977689959, 0.3718665701912302, -0.0044191725074663735, -0.22376396071448623, 0.3342324251357065, 0.5565906135737073, -0.47519645475077654, -0.3626073985609365, 0.6406240156717039, -0.5326921662344368, -0.7384690214927981, 0.6017977865340791, 0.5398388082915075, -0.24987178852094194, 0.10697675653522953, -0.08173744301779129, 0.7285421698762902, -0.14763969479181976, -0.25879855880688385, -0.07122892572193174, 0.24877234959265349, 0.07360566987487183, -0.4937245776385436, -0.09257482025546038, 0.44788706603025497, -0.030007679608548887, -0.31886743287871355, 0.1836258137738831, 0.2929631584807736,}, {0.10818307501413726, -0.13234737560712495, 0.001462194778679038, -0.05118037590553093, 0.1167287943576445, 0.08971838503985607, 0.11764879968968978, 0.007020639612302926, 0.15117969006056686, -0.02232561356070556, 0.031206097232611363, -0.5105221856805237, -0.07165923071940816, -0.11540330434037971, -0.42927138008790333, -0.27895384937501455, -0.037080125387024876, 0.18216893596526093, 0.007156941686789153, 0.10994976426506686, 0.07974105089327194, 0.4200182323168536, 0.1010334704249658, -0.09649045230443898, -0.1216745800726689, -0.006433840097155308, -0.7130038986383866, -0.2511433073260203, 0.1889830884515823, -0.31287967914464854, 0.0445363927008785, 0.1756514021724601,}, {-0.10179666879930993, -0.29612278015283316, -0.20679149839900535, -0.04652049895033139, 0.2114764900044822, 0.05270535291540579, 0.24088031182106406, 0.1569026884871254, 0.35155787400042504, 0.2975379607011201, 0.2695677561688946, 0.005474844161084208, -0.0016808128252967514, -0.09079671583076576, -0.2422152698154929, -0.223825025843023, -0.21933531144201723, 0.021959471219431648, -0.15284621880390237, 0.4643935600935616, 0.29674395426048505, 0.04569040868233165, 0.4429941970877582, 0.05408936338863368, -0.10066679644069354, -0.1510158889671891, -0.07896171175964646, -0.083143158360523, -0.3459932514783437, 0.023372145848175152, -0.06282152611686753, -0.034969155303434585,}, {0.02914600251415156, 0.08813679294336718, -0.1633291420600238, -0.05563312410233853, -0.19549889482470806, -0.22567093650359393, -0.08527985288948381, -0.06703929885002757, 0.1181086930233684, -0.08518492314489212, -0.07242469546169339, 0.3267759476643478, 0.213079289321993, 0.0513913033069453, 0.33474459258063716, 0.03987903703866108, -0.0049237744003383654, 0.1296255123461808, 0.09551559120000519, -0.15955342214584212, -0.21455233192635603, -0.11296921090191925, 0.15998152608910088, -0.007742170795083991, 0.16350079117501015, 0.20312985487211374, 0.11035157773867077, 0.19320794392682283, 0.28740807536485713, -0.1176997862377494, -0.14391103336673083, -0.06608554260753957,}, {-0.1435112251620517, -0.14224869782375116, -0.07790873208009905, 0.10380575087738914, 0.06990374230548946, 0.1853219055682296, 0.10740198833512571, 0.061720957033832846, -0.04550527107265667, -0.03230626888878274, -0.10385231962782354, -0.16380176733405505, -0.23964910839152487, -0.10979732128023995, 0.01089534738385467, -0.12785365263371862, -0.037617714770318195, 0.11226026436778103, 0.1809248715602898, 0.039379488070130586, 0.0555636037719863, 0.0012630299972902215, 0.03260919830032116, -0.11347116125800111, -0.001085856446314648, 0.11876894453846187, 0.048107389918566223, 0.007897551492719312, -0.0669256674040829, 0.08250747150556714, 0.07472575105888091, -0.0548091722913818,}, {-0.16040508449398355, -0.04968641754831771, -0.009608502951759856, -0.015272239130372817, -0.06193574163029414, 0.05853569044803264, 0.14392830516394062, 0.0015821550392118855, -0.07222938237513188, -0.014025625397541042, 0.0823109698727188, 0.07471649620217147, -0.06884381055869704, -0.015345969500232925, 0.006001428534840647, 0.023472447973332478, -0.022867331153141712, -0.08424496291546557, 0.017850115871909766, -0.0464172782801886, 0.0033509661973977756, 0.0037005141900653404, -0.05904729344553594, -0.013541064337642794, -0.004673602767547691, -0.004536287480937096, -0.013757043571983818, -0.07459781701263757, -0.07759169448316339, 0.0962144856944459, 0.07024043172138983, -0.08219792896581037,}, {0.003182212723605221, 0.00890262921150542, 0.03727382404944091, -0.061575459306055125, -0.046413949792919906, -0.036667235389542085, 0.04241432495341482, 0.012035736517952422, -0.0671287894536019, -0.020607992508318795, 0.05698541806581903, -0.030028523779256577, -0.10091862378607852, -0.09225126944251497, -0.027000101661705356, -0.06476548784973939, -0.06554021283166889, 0.01701274715327572, 0.11360809629379204, 0.09748864435306759, 0.0667231453217757, 0.042721527611074894, 0.02936426535386416, -0.009712498513272633, 0.023573881038020522, -0.0012721991634052632, -0.0035625458381798036, -0.021162313691654833, -0.042874937762724774, 0.0036606363267049635, 0.016242430806003183, -0.05886922324574706,}, {-0.0728291687916851, -0.05985153291996548, -0.01582015360408029, -0.029354435769979315, 0.031049111364842785, 0.040243539133384854, 0.01976903402997593, 0.02852389895777474, 0.030334642375136056, 0.036182228395824634, 0.04797264889187974, 0.033826462551983905, 0.07237616139598702, 0.05393073259104497, 0.01867845728007511, 0.022902947315326272, -0.0028982285119710793, -0.05692921273494267, -0.025156332461671538, -0.05331867883146435, -0.05752773359785879, -0.06781488290840915, -0.05109040966776757, -0.053731463461197754, -0.07769661925359658, -0.05434520779730018, -0.02537991890268776, -0.010937328333370244, 0.012071606120734324, 0.011825654137207042, 0.05351343851745638, 0.061141688278397055,}, {-0.05123964102907408, -0.02053814919522501, 0.016515070388495368, 0.010018772193820857, -0.02843169268225354, -0.03890027663727258, -0.016359173199996274, 0.012938908322953746, 0.021220404680716953, 0.005953894455308806, 0.007185071762363715, 0.010035933577224154, 0.02377644932626244, 0.005744858700911237, 0.012966098462810494, 0.012399710824955223, 0.002931551261880827, 0.015507873735835287, 0.005322771403265092, -0.0027934732329938927, 0.006489974265967091, 0.010959726815515713, -0.004549283310313124, 0.01535238648510906, 0.017076256309332294, -0.0205841041288517, -0.04014568876502422, -0.012996465777976363, 0.020658707029301393, 0.023047939784759608, -0.002700662097465556, 0.006116925961299646,}, {-0.0020941324584390353, 0.00021380356923006438, 0.011045432807262001, 0.018526424769247374, 0.017093712319933507, 0.003836614724276377, 0.0053406055274061726, 0.00975594077091091, 0.01844370260707484, -0.01687668293137634, -0.016497521729881948, 0.0016218575577531258, 0.0194142257950764, -0.021907699765719824, -0.016281357058667734, -0.007986669966269233, 0.014258955983451282, -0.0231063355767388, 0.007980146302785124, 0.014915886366546172, 0.017214197706041268, -0.027724715890324436, 0.008642355212911346, 0.0007260869858227714, 0.015276539423475288, -0.0032928567726291935, 0.008479931702406351, -0.002262332467931172, -0.0013073437063749749, -0.00595097713723769, -0.0059769811847107945, -0.020526966322355733,}, {0.006749903859457063, 0.0022706785408748154, 0.0005577545279661367, 0.0034864789561880327, 0.0073921430483161465, 0.0009670192071293826, -0.007132035961564753, -0.0021553792721993315, 0.00881608177900306, -0.010893479476470957, -0.0015992886887448154, 0.004050323912979215, 0.00012749012958301886, -0.008139954635783875, 0.004605126023064621, -0.004728132308229549, -0.006825660559454327, -0.014311085944261226, -0.003339015993285316, -0.004773775861649288, -0.008532149258390076, -0.007049721196362269, -0.007631703495187603, -0.0025932531678137527, -0.019384132684820643, -0.0006257122279897942, 0.007218684395033592, -0.007262016993023757, -0.005455287884767471, 0.006478315159049952, -0.013769587276001083, -0.0024786374080052465,}, {-0.0008614355901526705, -0.0019186311888628182, -0.006880853428736122, 0.003542797482922827, -0.0019747984682110253, -0.001253780988267117, 0.0037610207878523427, -0.0017356259744142344, 0.006294807913975742, 0.007635617427419028, 0.0007844630681459741, 0.004424558938086631, 0.0013308429279308975, -0.0030207145125781265, 0.0025150719780276387, 0.0020805044495281755, -0.006381500546362107, 0.003119955031252175, -0.0017384498659828163, -8.575121822063103e-06, 0.0017505603461108188, -0.0071307437841543475, 0.0012576311739865842, -0.0003656095394153902, -0.010223526789857607, 0.0018128349699882973, 0.003820959244609401, -0.006585540855339911, -0.0018191064166179771, 0.0015091862698304315, -0.006365297017999705, -0.0020926254454349813,}, {0.0004222818053086774, -0.0007646868365589476, -0.0034297900522910485, 0.00277177475150181, -0.0027594581948107155, -0.0010291604686319955, 0.006580043676121472, 0.0037149107778613466, -0.0010724067771212265, 0.0040347574157233446, -0.0017873613355283702, 0.003467579746744054, 0.006868106115078265, -0.002380321364977789, 0.005090264219590024, 0.00813001267370883, 0.0007232766903897403, 0.004897659487399786, -0.0032854836649415242, -0.0036942058462539062, 0.0007355268370052848, -0.0068941311230067415, -0.0035241706060236133, 0.0012870879857369427, -0.0012833183114732138, 0.002269486724310543, -0.004436254981464938, -0.00569583183545741, 0.0006025223716119577, -0.004201200107928571, 0.004037115252533807, 0.008550340075819673,},},
			want2:   [][]float64{{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,}, {0.7042949722286378, 0.07890544358773452, 0.00015042351645201826, -0.007877521023294958, 0.19354098403481937, -0.11385455574626965, -0.01237429873306535, 0.1663422420492151, 0.12909709165340882, -0.07391926287944772, -0.04310131887011262, 0.13547706592174247, -0.022879556820117337, -0.06394423933765864, -0.0667673346061588, 0.03370609975512316, -0.20120806529286314, -0.04539951004522119, 0.03560257778205872, 0.07501870893959572, -0.12595488327349524, -0.039556135382465656, -0.07730878100393117, -0.06358731322233815, -0.10447788912572192, 0.04011454369329688, 0.053219210818133876, 0.008912595635269508, 0.0005231539935652035, -0.007925967122213192, 0.021086735974641467, 0.002042981008599504,}, {0.892384790746479, 0.012373620818677523, -0.011470476048415782, -0.07312896837261335, 0.0926731173915071, 0.05165173679453181, -0.02334826204315842, 0.009655262500579753, 0.02039941740215818, 0.04177923039494345, -0.003783181605515664, -0.11308784458834327, 0.1541176725684209, 0.008705019200459031, -0.11123414905020237, -0.034209816379479646, -0.057080759994478245, 0.03431839006120526, -0.04244979021229303, -0.015531696411407465, 0.02220312808498965, 0.07065838339257327, -0.06460328712825529, -0.12676286264593964, 0.1130846736123999, 0.12211003836209658, -0.07615558956602791, 0.011020355379395972, 0.12054295405685825, -0.026161777897873495, -0.04288428456095813, 0.07951877174007418,}, {1.0387026160758546, -0.053808423761913, 0.0013626993192067715, -0.006413366991445299, 0.04376856356485069, 0.03798123274189914, -0.0033588953697255767, -0.00856242816268768, -0.028870310106928698, 0.011507883614301571, 0.01986537805718956, -0.0344020628206266, 0.054298734818521655, 0.0106865293923878, -0.002280263428789369, -0.0693242045199328, -0.0330026115766725, 0.09812355727154681, -0.04464364240104711, -0.1260723287806606, 0.10308237257796439, 0.02870894311774143, -0.13087316452429504, 0.020242085389622785, 0.028464607293187442, 0.05521155490542, 0.002621968964203771, 0.030027862363685005, 0.04160178079630213, 0.013427722075858895, 0.024982299902937752, -0.03086549144475149,}, {0.9873640540595163, -0.06182649870903511, -0.016339200497713542, -0.004556050781336997, -0.06589440586852494, 0.040255871460258746, 0.08200872635942336, -0.0077599150883276916, -0.02448513318344384, 0.04753228450854069, 0.0190099020251979, -0.010084074688490494, -0.012028723184121837, -0.0517403885667202, -0.027943257617157498, 0.028751456679228, -0.07448348400509042, -0.036157808103421896, 0.013683619816547667, 0.03667425317639582, -0.023793320607107718, -0.02718773789691383, 0.004376364951581452, 0.0435424016654073, -0.05349594479804775, 0.031004133581013282, 0.03523633714212243, -0.01677338043651609, -0.027282086727120278, 0.030147833010423883, 0.0016585799414572727, -0.03506955712298371,}, {1.003453416165895, 0.023437505704121748, 0.03864435807844013, 0.017098688687596668, -0.013216897001950365, 0.016223589335925326, 0.041701368218548265, -0.043182065129763685, -0.06844868777747518, 0.04015184703223279, -0.02251610562658387, 0.01219240498036777, -0.012968048533428967, 0.013205779525656006, 0.027990071199846648, 0.03221837752130195, -0.010789077153681183, -0.0036880008095290834, 0.0015034648718915988, 0.03472772042408144, 0.01019703052561589, -0.07895947734445685, -0.0029645322219777124, -0.00019742536656473423, -0.02469477995267505, -0.029562144520250265, 0.0407551422697307, 0.013428887094172708, 0.011560059878926072, 0.05534180694728458, 0.02175050142088604, 0.02650112608074049,}, {0.9935104404904767, -0.013524224176066066, -0.023198005325695763, -0.020539987526467577, -0.052195859949748694, 0.008164356611673, 0.014925764237798449, -0.016948897672760543, -0.0199640197653939, 0.05223643521522833, 0.04329557894219259, 0.02656497317837766, -0.009898466235380605, -0.02203923946433376, -0.02870913399035538, -0.018109253314052866, -0.06998364705965754, -0.055674840012736565, -0.03481028555178532, 0.012154266939455129, 0.02432813867184337, -0.018767201374657913, 0.05530886159180846, 0.05765994001863066, 0.0033420535487892985, -0.007261638758270593, 0.006058108420270508, -0.022624349999437035, -0.029056208668290937, -0.037645294724127476, 0.00043403481901379464, 0.0006540163020159693,}, {0.982425643266132, 0.004731917777102501, 0.008065380795336117, -0.008373750187571843, -0.016952898501506684, 0.022936334778318947, 0.0018994895627553702, 0.012419910460131899, -0.0023210844501224946, 0.011469530365680176, 0.04277244500368654, 0.03417734328673935, 0.001078894436020711, 0.005760601258006417, -0.007172698038538911, -0.0165320518807546, -0.05178594623925503, -0.04393949780995824, -0.0008714768477796125, -0.0013028924922732278, -0.01855699205018278, -0.0105578746460253, 0.03692351842254673, 0.04687606139822508, 0.018253722795969672, -0.03025016981882677, -0.008719695901940605, -0.0015240440750781217, 0.002802877743652163, 0.004704663512478257, 0.015449828476246643, 0.03246477704158278,}, {0.9974239840058052, 0.004636660998944017, 0.00812535056932432, -0.0003861811197809175, 0.003578812419744365, 0.031567799485144925, 0.006851351615236192, 0.01116491712113557, 0.001919373122755351, 0.000941456064190241, 0.02446748942693959, 0.02453254097791794, -0.0023547703276007243, 0.0044129024245847075, 0.0070517602960741945, -0.0012128634997065585, -0.03658360313224022, -0.02686551802087426, -0.0039222073383385105, -0.0006977412654847416, -0.021594225183744008, -0.013056156502078729, 0.012797196824608885, 0.024551575765636643, 0.003126233684205111, -0.018563012624837463, -0.0035137418913383897, 0.007703400038794777, 0.008211880217652151, 0.004951764577635248, 0.003951287867607087, 0.017828788275153388,}, {0.9985280319158562, 0.003510842512907346, 0.001802018107304943, 0.0035821580675559324, 0.007547800026648618, 0.013615511382114334, 0.011388381010393241, 0.012835236603516062, 0.0031290539971249487, 0.0032028404649014465, 0.011395824376417207, 0.017729092780943416, 0.0018003150529190765, 0.005773420916643705, -0.00014149693084727265, -0.005392137582453923, -0.02737276149346637, -0.019361287884769745, -0.0059239944588516695, -0.00958181048661531, -0.01434217596045044, -0.003137908588502482, 0.005092841445807794, 0.018772580487084484, -0.000589111670234089, -0.008012781535275538, -0.0018472109116024924, 0.00361463117350639, 0.007250333208611907, 0.0009997934939699601, 0.001867513511711068, 0.012179055526033749,}, {0.9945044057059123, 0.004560743947629873, 0.0013677196586589857, -0.005053282595002878, 0.003299121156406659, 0.014966092696927457, 0.0073675234062027094, 0.011283130463703822, 0.006696724153439176, 0.0024695466353354123, 0.003241324817404017, 0.0032470718485825036, -4.739586643171575e-06, 0.005329736383382041, -0.005222155525573476, -0.0034480286910595014, -0.010522234060882306, -0.007259404126901566, -0.006278457812558544, -0.009672101802717895, -0.007252269861379147, -0.0011569848259358716, -0.004957580043880135, 0.00260534630597979, -0.0008573424020232314, -0.006574997450564715, -0.004957194844255527, 0.0057432194004339255, 0.010357567336172276, 0.003900457437281329, 0.0016174773889693103, 0.004073593284694409,}, {1.00066621193294, 0.005809764307654848, -0.0022248117999908125, -0.007145285710381088, -0.005135797545477925, 0.0015326432366799558, -0.002826205217424345, -0.0016931250880854506, -0.0021329353105317647, -0.0026799354360490463, -0.005554079728523135, -0.0005810235635596449, -0.0009431754881455179, 0.003965304568812587, -0.00014775515584748478, 0.0002666006653209643, -0.0007259682568288528, 0.004577395815252024, 0.0044144414975536, 0.0010246136833645145, -0.0006516693825382959, 0.004656090170149587, -0.0006455905390145899, 0.0014954410085455012, -0.0024629234250043205, -0.00413197866279228, -0.0026467103219450713, 0.0012011417382440399, 0.0016387082155752577, -0.004322737862661108, -0.009031776531119909, -0.006363853523831972,}, {1.0008554900879651, 0.0017809266593761558, -0.003881119427843193, -0.0016167652718108605, -0.00077811669188051, -0.0003990997917993201, -0.004472957495324818, -0.0018405598748945681, -0.001101469454655819, -0.0019648579429150663, -0.00475207591385142, 0.00028710586765633356, -0.0010772377126753803, 0.0012762843972383125, -0.0017931432319489681, 0.0010744403266111, -5.059968519481204e-05, 0.003495292140215382, 0.0019533812098758625, 0.00028553458691071, -0.0002517641330007502, 0.003950301109243824, -0.002104219953868898, -0.0020142340477964727, -0.00048172495753763116, 0.0008359898613194245, -0.002299384689940628, -0.001193537400408339, -3.1291485415194112e-06, 0.0014035583435718637, -0.004119525538727182, -0.004142554981567402,}, {0.9992350106954548, -0.00025816328340932585, -0.0016898527548068697, -0.0013428108540988171, -0.0022956513294683737, -0.0031222038919045086, -0.0017700184939604408, -0.0008766494224060102, 3.778906044554286e-05, -0.0008281640783747036, 4.747617213151113e-05, -0.00027851764884769795, -0.0006888909909997588, -0.0012271021740084096, 0.0011121301670014706, 0.0005241015756600857, 7.276453990400232e-05, 0.00033176541398080843, 0.0026461725857558466, -0.0009746598464587637, -0.0003088826289906029, 0.0009137788067280048, 0.00014450586369860484, 0.0004743020992531183, 0.0001952347355927507, -0.00013438670876584756, 5.106191674828974e-05, 0.00016745028682958372, -0.0014133640795168144, -0.00012472471142103503, -0.002491111635148552, -0.001957559473364617,}, {1.0000584244808475, 0.00019584116743425704, -0.00024992516069208173, -0.0009887888507017415, -0.0013469052957391736, -0.0009414542057494759, -0.0016231469913125423, -7.779570252614801e-05, 8.788433229823251e-05, -0.00038422952503711186, 0.00038880902673962657, -0.0004316675889138123, -0.0008771238529722026, 0.0013702262402920614, -3.5938473242968664e-05, 0.00010071149395978146, 0.001510623127691033, 0.0005262625659231254, 0.0004041850138460487, 0.001046834619498854, 0.0006800156978408491, -0.0007684809158340319, 0.00041605572659029544, 0.0004955044910190476, -0.00021177890660305817, -0.00021227327376710772, 0.000134664774120679, 0.0009879618018264476, -0.0005531166475792829, -0.00203172044217717, -0.0008502209436755143, -0.0012278805593464275,}, {1.0005170365164937, 0.0007564189404971728, -0.000760133950851314, -0.00033781154209225285, -0.0007266113576782204, -0.0014916475786442291, -0.0009694682913348563, 0.00033836248086279157, -0.0006424557651860032, 0.0001112132533541482, -9.622198326872039e-05, -0.0009684273915274007, -0.0002666613835952927, 0.000176145132379985, 0.00020864444183412798, 0.0007291942023809734, 0.0001157114266169091, 0.0011150714611746423, 0.0004395160437069164, 0.0001542291829922237, 0.0009205652302462606, -0.0007001745341772827, 9.318570500580667e-06, 0.0007254460218602023, -0.000931356219355257, -0.00017472648493032443, 0.00035758439069910304, -0.0005091157906866017, 0.00025025598532597083, -0.001225373937207543, -0.0014585676734938336, -9.663586657718493e-05,},},
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			af, _ := NewFiltFBLMS(tt.fields.n, tt.fields.mu, tt.fields.w)
			got, got1, got2, err := af.Run(tt.args.d, tt.args.x)
			if (err != nil) != tt.wantErr {
				t.Errorf("Run() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			if !reflect.DeepEqual(got, tt.want) {
				t.Errorf("Run() got = %v\n, want %v\n", got, tt.want)
				for i := 0; i < m; i++ {
					fmt.Print("{")
					for k := 0; k < L; k++ {
						fmt.Printf("%g, ", got[i][k])
					}
					fmt.Print("}, ")
				}
				fmt.Println("")
			}
			if !reflect.DeepEqual(got1, tt.want1) {
				t.Errorf("Run() got1 = %v\n, want %v\n", got1, tt.want1)
				for i := 0; i < m; i++ {
					fmt.Print("{")
					for k := 0; k < L; k++ {
						fmt.Printf("%g, ", got1[i][k])
					}
					fmt.Print("}, ")
				}
				fmt.Println("")
			}
			if !reflect.DeepEqual(got2, tt.want2) {
				t.Errorf("Run() got2 = %v\n, want %v\n", got2, tt.want2)
				for i := 0; i < m; i++ {
					fmt.Print("{")
					for k := 0; k < L; k++ {
						fmt.Printf("%g, ", got2[i][k])
					}
					fmt.Print("}, ")
				}
				fmt.Println("")
			}
		})
	}
}

func ExampleExploreLearning_fblms() {
	rand.Seed(1)
	//creation of data
	//number of samples
	n := 512
	L := 32
	m := n / L
	mu := 0.0000001

	//input value
	var x = make([][]float64, m)
	for i := range x {
		x[i] = make([]float64, L)
	}
	//desired value
	var d = make([][]float64, m)
	for i := range d {
		d[i] = make([]float64, L)
	}
	var xRow = make([]float64, L)
	for i := 0; i < m; i++ {
		for j := 0; j < L; j++ {
			xRow = misc.Unset(xRow, 0)
			xRow = append(xRow, rand.NormFloat64())
		}
		copy(x[i], xRow)
		copy(d[i], x[i])
	}

	af, err := NewFiltFBLMS(L, mu, "zeros")
	check(err)
	es, mus, err := ExploreLearning(af, d, x, 0.00001, 1.0, 100, 0.5, 100, "MSE", nil)
	check(err)

	res := make(map[float64]float64, len(es))
	for i := 0; i < len(es); i++ {
		res[es[i]] = mus[i]
	}
	//for i := 0; i < len(es); i++ {
	//	fmt.Println(es[i], mus[i])
	//}
	eMin := floats.Min(es)
	fmt.Printf("the step size mu with the smallest error is %.3f\n", res[eMin])
	//output:
	//the step size mu with the smallest error is 0.010
}
