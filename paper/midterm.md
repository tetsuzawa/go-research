# タイトル原案
### コーパス

- Raspberry Pi
- Linux
- マイコン
- ドローン
- ADF
- ANC
- 信号処理
- リアルタイム
- 雑音除去
- アクティブフィルタ
- 雑音抑圧
- 


# 構成
- 研究背景 
  - スペースアカデミア
    - 超小型衛星開発を通した高専ネットワーク型宇宙人材育成」 プログラム
    - ワークショップの開催
      - 人工衛星設計の基本思想､ 太陽黒点と電磁波の関係など､ 宇宙空間に関する講習
    - 超小型衛星の開発教育
      - 衛星地上局用アンテナシステムを設置し、 人工衛星からの電波を受信・解析. 全国の高専連携で超小型衛星を開発
    - Raspberry Pi を使用した教材開発
  
  - Raspberry Piを使用した、ANCシステムの検討
    - ドローン

  - 研究室
    - 音に関連
  - 適応信号処理

- 能動騒音制御
  - ADF
  - アルゴリズム
  - 予測

- やりたいこと
  - ドローンと人間の音声を分離したい
    - ゆくゆくはドローンの騒音を抑圧したい
  - 方法
    - 音源分離技術
      > 絵を入れる
      - 一つのマイクを使用する単チャンネル音源分離
        - 雑音除去
          - 適応フィルタ
            - 能動騒音制御
            - これに使われるアルゴリズムを使用
            - 今回は難しいので二次経路は考えない（すなわち完全な内部処理）
            - そのうち考える
              - 反射音の問題
              - 振幅の問題
              - リアルタイム性の問題
              - 今回はここを検証!!
        - 話者分離

    - 複数のマイクを使用する多チャンネル音源分離がある
      - 独立成分分析
      - ビームフォーミング
        - DNN

- 理論
  - 

- 使用機器
  - Raspberry Pi 3B+
  - スペースアカデミア
    - Cortex-A53 （ARMv8）
    - CPU Clock 1.5GHz, 4 Core
    - Memory 1GB
      - ADCを持っていないので、拡張ボードを使用
      - Pumpkin Pi
        - 24 Bit, Sampling rate 48 kHz.

  - 自作のバイノーラルマイクを使用 
  - XCM6035 * 2

  - プログラム
    - Golang を使用
      - 並行処理を簡単に実装可能
        - アルゴリズムによっては大規模計算に有利
          - ラズパイをスタックし、多コアのスパコンを作ると面白いかも？
      - GCを搭載しているのでメモリ管理の手間が省ける
        - プロトタイプが簡単
      - クロスコンパイルが簡単にできる
        - ローカル環境で開発・テストし、ラズパイに実装可能。
      - 速度がそこそこ速い
      - 仕様がシンプルで学習しやすい
      - 誰が書いても同じコードになりやすい
        - 読みやすい

    - Portaudioを使用
      - プラットフォーム依存が無いため

- やったこと
  - ADFのパッケージを開発した。
    - アルゴリズムの種類
      - LMS
      - NLMS
      - RLS
      - AP
      - FBLMS
    - 最適なステップサイズを自動計算可能
    - 実装までのドキュメントを作った
  - [github](https://github.com/tetsuzawa/go-adflib)で公開
  - 
- やること
  - 定常状態の評価
    - 定常状態で各dBでノイズを合成
     - 音圧と電圧の変換が必要
    - 音声コーパスを使用
    - 収束時間
    - S/N比の算出
    - 明瞭度試験の実施
    - 実験方法
      - 実験室のスピーカーから音を出す
        - 耳元で騒音計でdBを測る
        - オシロスコープで電圧測定
      - ドローンを回す
        - 耳元で騒音計でdBを測る
        - オシロスコープで電圧測定

  - 非定常状態の評価
  - 姿勢の変化を計測
    - その時のS/N比がどの程度変わるか計測



- MEMO
  - 先行研究
    - raspi ANC
    -  水中でNLMS0.894dB減った


  - 適応フィルタメモ
    - ウィナーフィルタを基礎としている
      - ウィナーフィルタの最適解をサンプルの平均から近似的に求める最小二乗法
      - ウィナーフィルタの最適解を反復により逐次的に求める適応アルゴリズム
        - 適応アルゴリズムによる逐次解法は、組込みシステムなど、実装する際にシステムの計算資源に制約がある場合に有用
        - ウィナーフィルタは定常過程を前提としているが、適応アルゴリズムを採用することにより、系が変動する場合もこれに追従することができるようになる。

  
  - 線形観測モデル
    - \symbf{z} = \symbf{H} \symbf{x} + \symbf{v} 
    - 観測行列 \symbf{H} 
    - 雑音 \symbf{v} 
    - 真値 \symbf{x} 
    - 観測値 \symbf{z} 

  - 線形推定器で真値 \symbf{x} から 推定値\hat{\symbf{x}}を求める
    - \hat{\symbf{x}} = \symbf{A} \symbf{z} + \Beta

  - MMSE法はパラメータの推定値 \hat{\symbf{x}} と 真値 \symbf{x} の差を誤差  
    - \tilde{\symbf{x} } := \hat{\symbf{x}} - \symbf{x}
    - で定義し、二乗平均誤差(mean square error)
    -  J = E[||\hat{ \symbf{x} } ||^2] を最小化する問題である。

  - 線形MMSE法
    - J = E[||\hat{ \symbf{x} } ||^2] 
    - 誤差と線形推定器の式より次の正規方程式を得ることができる。
    - \symbf{A} \symbf{P}_z = \symbf{P}_{xz}   
    - ゴニョゴニョして求めた係数と線形推定器を代入すると
    - \hat{\symbf{x}} = \symbf{\mu}_x + \symbf{P}_{xz} \symbf{P}_z^{-1} ( z - \mu_z )
    - \symbf{P} は共分散行列の要素

  - ウィナーフィルタ
    - ウィナーフィルタは線形MMSE法を定常な時系列に適用した特殊型である。
    - fig (適応フィルタ)
    - ウィナーフィルタは線形推定器の式を
      - z = \symbf{x}_k 
      - \symbf{A} = \symbf{w}^H
      - x = d_k
      - \hat{x} = y_k
      - \tilde{x} = \epsilon_k
    - と置き換えたものである。
    - 従って正規方程式も
      - \symbf{P}_z = \symbf{R}_x  
      - \symbf{P}_{xz} = \symbf{r}_{dx}
      - \symbf{A} = \symbf{w}^H  
    - より、 \symbf{w}^H \symbf{R}_x = \symbf{r}_{dx} となる。
    - ウィナーフィルタでは二乗平均誤差を最小とするフィルタ\symbf{w}をこの正規方程式より最適解を求める。

  - 最急降下法
    - 最急降下法では二乗平均誤差を最小とするフィルタ\symbf{w}を、反復法を用いて逐次的に求める 
    - 反復法では、フィルタ係数の初期値を適当に定め、コスト関数 J(\symbf{w}) の最小値を目指して、フィルタ係数を少しずつ変化させていく。
  TODOTODOTODOTODOTODOTODOTODOTODOTODOTODOTODOTODO
  


  - 適応フィルタ
    - ウィナーフィルタ
    - 画像

  - バックグラウンドをANCにするか音を聞きたいにするか
  - ANC
    - 今のまま
  - 音を聞きたい
    - ビームフォーマなどの話につながるかも


  - 適応フィルタで求めるのは空間の伝達関数
  - 収束速度の比較は空間の伝達関数ありの場合でもとめる
  - x d 直結かつnoise v 0 の場合同定するシステムが無いので、1サンプルで求まる。
  - よって、NLMSは妥当
  - RLSが求められていないのはおかしい？
  - 収束速度の比較は擬似的に空間の伝達関数を作って比較


- 12/4
  - 作ったgifは
    - x sin+rand
    - d sin+rand+rand
    - もし
      - x sin
      - d sin+rand+convolution
      - 検証する必要ありかも