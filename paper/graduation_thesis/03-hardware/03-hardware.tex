\chapter{ハードウェアの製作}\label{hardware}

この章では本研究で使用するドローン、マイク、Raspberry
Piといったハードウェアの構成と製作について述べる。

\
\section{システムの外観}\label{system-overview}

まず、ドローンの本体のシステムについて述べる。

\
\section{ドローンについて}\label{about-drone}

ドローンはリンクスモーション株式会社の組み立て式ドローン (Hquad500)
を使用した。このドローンは機体にカーボンファイバーを採用しており、軽量、高強度、高剛性を兼ね備えている。また、拡張性が高く、容易に機能の追加が可能で様々な研究用途に適した製品である。

\
\subsection{使用機器}\label{used-equipments-drone}

使用機器を以下に示す。

\begin{enumerate}
\renewcommand{\labelenumi}{(\arabic{enumi})}
\item
  ドローンの機体 HQuad500 Hardware kit Lynxmotion株式会社
  \cite{hquad500_hardware:online}
  \cite{hquad500_hardware}
  \includegraphics[width=13cm]{figures/hquad500_hardware.jpg}
  \includegraphics[width=13cm]{figures/hquad500_parts.jpg}
\item
  ESC (Electronic Speed Controller) 12A ESC (SimonK) Lynxmotion株式会社
  \cite{http://www.lynxmotion.com/p-915-12a-esc-simonk.aspx}{ESC}
  \includegraphics[width=13cm]{figures/esc.jpg}
\item
  ブラシレスモーター Brushless Motor 28x30 1000kv Lynxmotion株式会社
  \cite{http://www.lynxmotion.com/p-913-brushless-motor-28x30-1000kv.aspx}{ブラシレスモーター}{]}
  \includegraphics[width=13cm]{figures/brushless_motor.jpg}
\item
  フライトコントローラー Quadrino Nano Lynxmotion株式会社
  \cite{http://www.lynxmotion.com/p-1020-lynxmotion-quadrino-nano-flight-controller-with-gps.aspx}{フライトコントローラー}
  \includegraphics[width=13cm]{figures/quadrino_nano.jpg}
\item
  リポバッテリー充電器 18W LiPo Battery Charger Lynxmotion株式会社
  \cite{http://www.lynxmotion.com/p-985-18w-lipo-battery-charger.aspx}{リポバッテリー充電器}
  \includegraphics[width=13cm]{figures/lipo_charger.jpg}
\item
  リポバッテリー 11.1V (3S), 3500mAh 30C LiPo Battery Pack
  Lynxmotion株式会社
  \cite{http://www.lynxmotion.com/p-985-18w-lipo-battery-charger.aspx}{リポバッテリー充電器}
  \includegraphics[width=13cm]{figures/lipo_charger.jpg}
\item
  ラジオレシーバー R9DS 10 channels 2.4GHz DSSS FHSS Receiver
  RadioLink株式会社
  \cite{http://www.radiolink.com.cn/doce/product-detail-120.html}{ラジオレシーバー}
  \includegraphics[width=13cm]{figures/r9ds.jpg}
\item
  トランスミッタ AT9S 2.4GHz 10CH transmitter RadioLink株式会社
  \cite{http://www.radiolink.com.cn/doce/product-detail-119.html}{トランスミッタ}
  \includegraphics[width=13cm]{figures/at9s.jpg}
\end{enumerate}

\
\subsection{組み立ておよび動作確認}\label{assembly-drone}

ドローンの組み立ては@に従い、次のように行った。

\begin{enumerate}
\renewcommand{\labelenumi}{(\arabic{enumi})}
\item
  内容物の確認

  \begin{itemize}
  \tightlist
  \item
    表でリスト
  \item
    写真 \includegraphics[width=13cm]{figures/drone_parts.png}
  \end{itemize}
\item
  機体の組み立て・源および信号線の配線
  \includegraphics[width=13cm]{figures/drone_block.pdf}
  \includegraphics[width=13cm]{figures/drone_block.png}
\item
  動作確認
  \cite{http://www.lynxmotion.com/images/document/PDF/LynxmotionUAV-QuadrinoNano-UserGuideV1.1.pdf}{ドローンの取扱説明書}
  に従い、動作確認を行った。
\end{enumerate}

\
\section{バイノーラルマイクの製作}\label{binaural-mic}

\
\subsection{マイクについて}\label{about-mic}

収音には、音像定位実験のために製作したバイノーラルマイクを流用した。

使用した素子は秋月電子のエレクトレットコンデンサーマイクロホン（ECM）\cite{http://akizukidenshi.com/catalog/g/gP-08181/}{エレクトットコンデンサマイク}である。製作は@のようにLRそれぞれエレクトットコンデンサマイクをはんだ付けし、ロボットケーブルを経由してステレオミニプラグと接続した。

\begin{itemize}
\tightlist
\item
  使用機器

  \begin{enumerate}
  \renewcommand{\labelenumi}{(\arabic{enumi})}
  \item
    エレクトットコンデンサマイク XCM6035 株式会社秋月電子通商
    \cite{http://akizukidenshi.com/catalog/g/gP-08181/}{url} x2
    \includegraphics[width=13cm]{figures/microphone.jpg}
    \includegraphics[width=13cm]{figures/microphone_size.jpg}
  \item
    シールドスリムロボットケーブル KRT-SW 株式会社秋月電子通商
    \cite{http://akizukidenshi.com/catalog/g/gP-07457/}{url}
    \includegraphics[width=13cm]{figures/sielded_robot_cable.jpg}
    \includegraphics[width=13cm]{figures/sielded_robot_cable_size.jpg}
  \item
    3.5mmΦステレオミニプラグ MP-319 株式会社秋月電子通商
    \includegraphics[width=13cm]{figures/mini_plug.jpg}
    \includegraphics[width=13cm]{figures/mini_plug_size.jpg}
  \end{enumerate}
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=13cm]{@TODO}
\caption{バイノーラルマイクの製作}
\end{figure}

\
\section{Raspberry
Piについて}\label{about-raspberry}

Raspberry
Piは英国のラズベリーパイ財団によって開発されている、ARMプロセッサを搭載したシングルボードコンピュータである。Raspberr
Piは教育用として制作されたが、現在ではIoT製品開発などの業務や人工衛星のOBC
(On Board Computer) にも使用されている。

Raspberry Piには

\begin{itemize}
\tightlist
\item
  Linux系のOSで動作するためソフトウェア開発に強みをもち、GPIOピンを通してSPI、I2C、I2Sなどの通信を行えるため、センサなどを用いた開発を容易に行える。また、USB端子を搭載し、Wi-Fi、Bluetooth接続も可能で
  プロタイプ開発に適したデバイスとなっている。
\end{itemize}

\subsection{OSの選定}\label{choose-os}

Raspberry Piで使用可能なOSには

\begin{itemize}
\tightlist
\item
  電子工作などに適した公式OS Raspbian
\item
  LinuxディストリビューションのUbuntuから派生した Ubuntu MATE
\item
  Microsoft Windows 10
\end{itemize}

などが存在する。

本研究では主にGPIOを使用して開発を行うため、Raspbianを使用した。なお、OSのバージョンは10.1
Buster Liteである。また、カーネルのバージョンは4.19.75-v7である。

\subsection{初期設定について}\label{about-setup}

\begin{enumerate}
\renewcommand{\labelenumi}{(\arabic{enumi})}
\item
  OSのインストール
\item
  地域、言語の設定 \texttt{sudo\ raspi-config}\\
  Localization Options
\item
  sshの設定 \texttt{sudo\ raspi-config}\\
  Interfacing Options\\
  SSH
\item
  プロキシに関する設定
\item
  アップデート

\begin{lstlisting}[caption=@TODO,label=@TODO]
sudo apt update 
sudo apt upgrade -y 
sudo apt dist-upgrade
sudo rpi-update
sudo reboot
\end{lstlisting}
\end{enumerate}

\
\subsection{AD変換用の拡張ボードについて}\label{about-adc}

Raspberry
PiはADC（ADコンバータ）を搭載していないため、マイクからの入力信号を扱うにはADコンバータを導入する必要がある。

本研究で用いたのはマルツエレック株式会社の\cite{http://select.marutsu.co.jp/list/detail.php?id=258}{Pumpkin
Pi}である。Pumpkin
Piは計測用とオーディオ用のデュアルA-Dコンバータを搭載しており、Raspberry
Piにオーディオ入力、アナログ入力機能を加えることが可能となる。

Pumpkin Piの仕様を以下に示す。

\begin{itemize}
\tightlist
\item
  対応OS Raspbian
\item
  対応機種 Raspberry Pi Model B+/Raspberry Pi 2 Model B/Raspberry Pi 3
  Model B
\item
  LED出力 1点
\item
  赤外線リモコン機能 送受信
\item
  オーディオコネクタ φ3.5mmステレオミニジャック
\item
  オーディオ入力 量子化ビット数=24,サンプリング周波数=48/96KHz
\item
  計測用AD変換 2チャンネル,16ビット
\item
  本体寸法 65(W)×56(D)mm
\item
  本体重量 約25g
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=13cm]{figures/pumpkin_pi.jpg}
\caption{PumpkinPi}
\end{figure}

\cite{http://select.marutsu.co.jp/list/detail.php?id=258}{PumpkinPi}
\cite{https://www.marutsu.co.jp/pc/i/833515/}{PumpkinPi}

\
\subsection{セットアップ}\label{adc-setup}

Pumpkin
Piのセットアップは\cite{https://toragi.cqpub.co.jp/tabid/829/Default.aspx}{トランジスタ技術
2017年1月号 オールDIPで1日製作!　音声認識ハイレゾPiレコーダ「Pumpkin
Pi」} にしたがって行った。以下に簡易的な手順を示す。

\begin{enumerate}
\renewcommand{\labelenumi}{(\arabic{enumi})}
\item
  Pumpkin Piを使用するためのRaspberry Pi固有の設定

  まず適当な作業ディレクトリで以下のコマンドを実行する。

\begin{lstlisting}[caption=@TODO,label=@TODO]
wget http://einstlab.web.fc2.com/RaspberryPi/PumpkinPi.tar
tar xvf PumpkinPi.tar
cd PumpkinPi
./setup.sh  # @参考文献では ./PumpkinPi.sh と表記されている
\end{lstlisting}
\item
  カーネルとデバイス・ドライバのバージョンの確認

  カーネルのバージョンとデバイス・ドライバのバージョンは同じである必要がある。カーネルのバージョンは\texttt{uname\ -r}で、デバイス・ドライバのバージョンは\texttt{modinfo\ snd\_soc\_pcm1808_adc.ko}でそれぞれ確認できる。
\item
  ADコンバータ用のデバイス・ドライバのインストール

  次の2つのデバイス・ドライバをインストールする。

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \tightlist
  \item
    pcm1808-adc.ko\\
    PCM1808固有の動作を決定するドライバ。
  \item
    snd\_soc\_pcm1808\_adc.ko\\
    Raspberry Piのサウンドとして属性を決定するドライバ
  \end{enumerate}

  まず、ホームディレクトリにPumpkinPi.tarをダウンロードして展開する。

\begin{lstlisting}[caption=@TODO,label=@TODO]
cd 
wget http://einstlab.web.fc2.com/RaspberryPi/PumpkinPi.tar
tar xvf PumpkinPi.tar
cd PumpkinPi/Driver
\end{lstlisting}

  次にデバイス・ドライバをインストールする。

\begin{lstlisting}[caption=@TODO,label=@TODO]
sudo cp Backup/pcm1808-adc.bak/ /lib/modules/`uname -r`/kernel/sound/soc/codecs/pcm1808-adc.ko
sudo cp Backup/snd_soc_pcm1808_adc.bak /lib/modules/`uname -r`/kernel/sound/soc/bcm/snd_soc_pcm1808_adc.ko
sudo depmod -a  # 依存関係を調整
\end{lstlisting}

  OSのカーネル4.4以降ではデバイス・ツリー構造を導入してあるため、デバイス・ツリー情報ファイルをコピーする。

\begin{lstlisting}[caption=@TODO,label=@TODO]
sudo cp pcm1808-adc.dtbo /boot/oberlays/
\end{lstlisting}

  最後にデバイス・ドライバが電源起動時に自動的に読み込まれるように\texttt{/boot/config.txt}につぎの1行を追加する。

\begin{lstlisting}[caption=@TODO,label=@TODO]
dtoverlay=pcm1808-adc
\end{lstlisting}

  以上の作業を完了した後、再起動することで設定が適用される。
\end{enumerate}
